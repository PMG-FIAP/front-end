console.log(utils);class MapaAlagamentos{constructor(){this.map=null,this.markers=[],this.circles=[],this.alagamentos=utils.storage.get("alagamentos")||[],this.init()}init(){this.map=new google.maps.Map(document.getElementById("mapa"),{zoom:14,center:{lat:-23.55052,lng:-46.633308},mapTypeId:"roadmap"}),this.carregarAlagamentos(),this.map.addListener("click",(a=>{this.adicionarAlagamento(a.latLng)}))}adicionarAlagamento(a){const t={id:Date.now(),lat:a.lat(),lng:a.lng(),data:(new Date).toISOString()};this.alagamentos.push(t),this.atualizarStorage(),this.atualizarMapa()}atualizarStorage(){utils.storage.set("alagamentos",this.alagamentos)}carregarAlagamentos(){this.markers.forEach((a=>a.setMap(null))),this.markers=[],this.alagamentos.forEach((a=>{this.criarMarcador(a)})),this.atualizarCirculos()}criarMarcador(a){const t=new google.maps.Marker({position:{lat:a.lat,lng:a.lng},map:this.map,title:`Alagamento reportado em ${utils.date.formatDateTime(a.data)}`});t.addListener("click",(()=>{confirm("Deseja remover este ponto de alagamento?")&&this.removerAlagamento(a.id)})),this.markers.push(t)}removerAlagamento(a){this.alagamentos=this.alagamentos.filter((t=>t.id!==a)),this.atualizarStorage(),this.atualizarMapa()}atualizarCirculos(){this.circles.forEach((a=>a.setMap(null))),this.circles=[];this.agruparAlagamentos().forEach((a=>{let t,e;t=e=a.length>=4?"#F44336":"#FFC107";const s=new google.maps.Circle({strokeColor:t,strokeOpacity:.8,strokeWeight:2,fillColor:e,fillOpacity:.35,map:this.map,center:utils.geo.calculateCenter(a),radius:500,clickable:!1});this.circles.push(s)}))}agruparAlagamentos(){const a=[],t=new Set;return this.alagamentos.forEach((e=>{if(t.has(e.id))return;const s=[e];t.add(e.id),this.alagamentos.forEach((a=>{if(t.has(a.id))return;utils.geo.calculateDistance(e.lat,e.lng,a.lat,a.lng)<.3&&(s.push(a),t.add(a.id))})),a.push(s)})),a}atualizarMapa(){this.markers.forEach((a=>a.setMap(null))),this.markers=[],this.carregarAlagamentos()}}window.initMap=()=>{window.mapaAlagamentos=new MapaAlagamentos};